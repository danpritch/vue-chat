{
  "ksql": "CREATE TABLE conversations_table ( id BIGINT PRIMARY KEY, owner_id BIGINT) WITH ( KAFKA_TOPIC = 'postgres.chat.conversations', VALUE_FORMAT = 'JSON', KEY_FORMAT = 'JSON'); CREATE STREAM participants_stream ( id BIGINT, conversation_id BIGINT, participant_id BIGINT) WITH ( KAFKA_TOPIC = 'postgres.chat.participants', VALUE_FORMAT = 'JSON'); CREATE STREAM participants_stream_rekeyed WITH (PARTITIONS = 1) AS SELECT * FROM participants_stream PARTITION BY conversation_id; CREATE TABLE participants_by_conversation WITH (KAFKA_TOPIC='kafka.chat.participants_by_conversation', VALUE_FORMAT='JSON') AS SELECT conversation_id, COLLECT_LIST(participant_id) AS participant_ids FROM participants_stream_rekeyed GROUP BY conversation_id; CREATE TABLE conversation_owner_participants WITH (KAFKA_TOPIC='kafka.chat.conversation_owner_participants', VALUE_FORMAT='JSON') AS SELECT c.id AS conversation_id, c.owner_id, p.participant_ids FROM conversations_table c LEFT JOIN participants_by_conversation p ON c.id = p.conversation_id;",
  "streamsProperties": {"ksql.streams.auto.offset.reset": "earliest"}
}